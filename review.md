# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
動的webページの表示内容の生成を行う際に、悪意を持って任意のスクリプトを紛れ込ませ、ユーザーがwebサイトを閲覧するときに上記のスクリプトが実行されて、
webサイト制作者が意図していない挙動を行わせる攻撃。
【攻撃者のメリット】
・ユーザーのcookie情報を盗ることができ、機密情報が含まれていた場合、
それらの情報も取得できてしまう。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。
「htmlspecialchars()」といちいち長くコードを書かなくてよいため、
コードを書くとき簡単になり、尚且つ可読性が高い。

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。
エスケープ処理が行われることで、
入力フォームからページに送信されるデータ内にスクリプトを入力されても、
HTMLタグとして動作する「<」「>」などが違う文字列に置き換えられ、
スクリプトとして動作することを防げるから。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
偽サイトへ誘導したうえで、正当なユーザーの承認情報を悪用して、
特定のウェブサイトへの不正なリクエストを送信させる攻撃。
【攻撃者のメリット】
・被害者のアカウントへログインしてユーザー名やパスワード、個人情報などを盗み出すことができる
・攻撃者が被害者のアカウントに代わって、不正な購入やメッセージの送信、プライバシーの設定変更など、不正なアクションを行える

### SessionとCookieの違いを説明してください。
データを保存する領域（場所）が違います。
Cokkieはユーザーのブラウザに直接データが一時的に保存される仕組みで、
Sessionは、サーバー側にデータを一時的に保存する仕組みという違いがあります。

### `setToken()`が何をしているか説明してください。
Sessionの中にキー名が「token」を作成し、16文字のランダムなバイト文字の値を持たせています。

### `checkToken()`が何をしているか説明してください。
サーバー側がクライアント側からのリクエストを受け取った際、
セッションのトークンが空だった場合、またはクライアント側に渡していたトークンと受け取ったトークンが違うとき、「不正な操作です」というエラー文をセッションに格納し、元の参照ページに戻る処理を行っている。

### トークンを使うことでなぜCSRFが防げるのか説明してください。
クライアント側からのリクエストに対し、
サーバー側がトークンを含んだHTMLを渡して、
再度クライアント側からリクエストされた際に、上記で渡したトークンも送信してもらい、トークンが一致しているか確認することで正しいリクエスト元か判断し、
正しいリクエスト元からリクエストされたときにだけアプリが動くようにできるから。

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
断片的なSQL文をアプリケーションに不正に入力して実行させ、攻撃者がデータベースを操作する攻撃。
【攻撃者のメリット】
・個人情報などを盗める
・データの改ざんを行える
・システムやサーバーを乗っ取れる

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。
PDOStatementオブジェクトでSQL文を返します。
用意したSQL文をプレースホルダーとして実行準備を行うメソッド。

### `->bindValue()`が何をしているか説明してください。
プレースホルダーに何を代入するかを指定している。

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
ユーザーが入力したデータのデータ型を指定し、文字列として認識させることで、
悪意を持ってSQL文と誤認させるデータを単なる文字列のデータとして認識させ、
SQL文に影響させないようにしているから。

## バリデーション

### バリデーションの目的について説明してください。
必ず入力してほしい箇所に入力がされているかや、
入力された値が、制限通りの内容になっているかどうかを確認する目的。

### `validate()`が何をしているか説明してください。
もし内容がセットされていて、さらにその内容の項目が空欄だったら、
入力がありませんと表示されて、元のページになるようリダイレクトされる。

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。
「$post['content']の値が格納されているか確認するため。
ない場合、値が格納されているか確認できない。

## その他

### `unsetError()`を実行しないとどうなるか説明してください。
エラー文がブラウザ上に表示されてしまう。